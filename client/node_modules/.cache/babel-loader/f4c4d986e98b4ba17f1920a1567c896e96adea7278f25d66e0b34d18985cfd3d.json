{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useContext, useEffect, useState } from \"react\";\nimport { tokenContext } from \"../context/TokenContext\";\nimport io from \"socket.io-client\";\nexport default function useSockets() {\n  _s();\n  const [socket, setSocket] = useState();\n  const [onlineUsers, setOnlineUsers] = useState([]);\n  const [socketLoading, setSocketLoading] = useState(false);\n  const {\n    token\n  } = useContext(tokenContext);\n  const getSockets = async () => {\n    if (token) {\n      try {\n        setSocketLoading(true);\n        const socket = await io(\"http://localhost:8000/\", {\n          query: {\n            authorization: token\n          }\n        });\n        console.log(socket);\n        socket.on(\"newChat\", message => {\n          console.log(message);\n        });\n        socket.on(\"newMessage\", message => {\n          console.log(message);\n        });\n        setSocket(socket);\n        // socket.on() is used to listen to the events. can be used both on client and server side\n        socket.on(\"getOnlineUsers\", users => {\n          setOnlineUsers(users);\n        });\n        return () => socket.close();\n      } catch (error) {\n        console.log(error);\n      } finally {\n        setSocketLoading(false);\n      }\n    } else {\n      if (socket) {\n        socket === null || socket === void 0 ? void 0 : socket.close();\n        setSocket(\"\");\n      }\n    }\n  };\n  useEffect(() => {\n    getSockets();\n    // eslint-disable-next-line\n  }, [token]);\n  return {\n    socket,\n    onlineUsers,\n    socketLoading\n  };\n}\n_s(useSockets, \"NN99EQEuNArdEvvUQYXKt31/USI=\");","map":{"version":3,"names":["useContext","useEffect","useState","tokenContext","io","useSockets","_s","socket","setSocket","onlineUsers","setOnlineUsers","socketLoading","setSocketLoading","token","getSockets","query","authorization","console","log","on","message","users","close","error"],"sources":["C:/Users/black/OneDrive/Рабочий стол/pdp_chat/client/src/hooks/useSockets.jsx"],"sourcesContent":["import { useContext, useEffect, useState } from \"react\";\r\nimport { tokenContext } from \"../context/TokenContext\";\r\nimport io from \"socket.io-client\";\r\n\r\nexport default function useSockets() {\r\n  const [socket, setSocket] = useState();\r\n  const [onlineUsers, setOnlineUsers] = useState([]);\r\n  const [socketLoading, setSocketLoading] = useState(false);\r\n  const { token } = useContext(tokenContext);\r\n\r\n  const getSockets = async () => {\r\n    if (token) {\r\n      try {\r\n        setSocketLoading(true);\r\n        const socket = await io(\"http://localhost:8000/\", {\r\n          query: {\r\n            authorization: token,\r\n          },\r\n        });\r\n\r\n        console.log(socket);\r\n\r\n        socket.on(\"newChat\", (message) => {\r\n          console.log(message);\r\n        });\r\n\r\n        socket.on(\"newMessage\", (message) => {\r\n            console.log(message);\r\n        })\r\n\r\n        setSocket(socket);\r\n        // socket.on() is used to listen to the events. can be used both on client and server side\r\n        socket.on(\"getOnlineUsers\", (users) => {\r\n          setOnlineUsers(users);\r\n        });\r\n\r\n        return () => socket.close();\r\n      } catch (error) {\r\n        console.log(error);\r\n      } finally {\r\n        setSocketLoading(false);\r\n      }\r\n    } else {\r\n      if (socket) {\r\n        socket?.close();\r\n        setSocket(\"\");\r\n      }\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    getSockets();\r\n    // eslint-disable-next-line\r\n  }, [token]);\r\n\r\n  return { socket, onlineUsers, socketLoading };\r\n}\r\n"],"mappings":";AAAA,SAASA,UAAU,EAAEC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AACvD,SAASC,YAAY,QAAQ,yBAAyB;AACtD,OAAOC,EAAE,MAAM,kBAAkB;AAEjC,eAAe,SAASC,UAAUA,CAAA,EAAG;EAAAC,EAAA;EACnC,MAAM,CAACC,MAAM,EAAEC,SAAS,CAAC,GAAGN,QAAQ,CAAC,CAAC;EACtC,MAAM,CAACO,WAAW,EAAEC,cAAc,CAAC,GAAGR,QAAQ,CAAC,EAAE,CAAC;EAClD,MAAM,CAACS,aAAa,EAAEC,gBAAgB,CAAC,GAAGV,QAAQ,CAAC,KAAK,CAAC;EACzD,MAAM;IAAEW;EAAM,CAAC,GAAGb,UAAU,CAACG,YAAY,CAAC;EAE1C,MAAMW,UAAU,GAAG,MAAAA,CAAA,KAAY;IAC7B,IAAID,KAAK,EAAE;MACT,IAAI;QACFD,gBAAgB,CAAC,IAAI,CAAC;QACtB,MAAML,MAAM,GAAG,MAAMH,EAAE,CAAC,wBAAwB,EAAE;UAChDW,KAAK,EAAE;YACLC,aAAa,EAAEH;UACjB;QACF,CAAC,CAAC;QAEFI,OAAO,CAACC,GAAG,CAACX,MAAM,CAAC;QAEnBA,MAAM,CAACY,EAAE,CAAC,SAAS,EAAGC,OAAO,IAAK;UAChCH,OAAO,CAACC,GAAG,CAACE,OAAO,CAAC;QACtB,CAAC,CAAC;QAEFb,MAAM,CAACY,EAAE,CAAC,YAAY,EAAGC,OAAO,IAAK;UACjCH,OAAO,CAACC,GAAG,CAACE,OAAO,CAAC;QACxB,CAAC,CAAC;QAEFZ,SAAS,CAACD,MAAM,CAAC;QACjB;QACAA,MAAM,CAACY,EAAE,CAAC,gBAAgB,EAAGE,KAAK,IAAK;UACrCX,cAAc,CAACW,KAAK,CAAC;QACvB,CAAC,CAAC;QAEF,OAAO,MAAMd,MAAM,CAACe,KAAK,CAAC,CAAC;MAC7B,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdN,OAAO,CAACC,GAAG,CAACK,KAAK,CAAC;MACpB,CAAC,SAAS;QACRX,gBAAgB,CAAC,KAAK,CAAC;MACzB;IACF,CAAC,MAAM;MACL,IAAIL,MAAM,EAAE;QACVA,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEe,KAAK,CAAC,CAAC;QACfd,SAAS,CAAC,EAAE,CAAC;MACf;IACF;EACF,CAAC;EAEDP,SAAS,CAAC,MAAM;IACda,UAAU,CAAC,CAAC;IACZ;EACF,CAAC,EAAE,CAACD,KAAK,CAAC,CAAC;EAEX,OAAO;IAAEN,MAAM;IAAEE,WAAW;IAAEE;EAAc,CAAC;AAC/C;AAACL,EAAA,CApDuBD,UAAU","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}